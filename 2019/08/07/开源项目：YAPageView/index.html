<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="å¼€æºé¡¹ç›®ï¼šYAPageView">




  <meta name="keywords" content="iOSå¼€å‘,å¼€æºé¡¹ç›®,">




  <link rel="alternate" href="/atom.xml" title="Ya">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x">



<link rel="canonical" href="http://blog.chenyalun.com/2019/08/07/å¼€æºé¡¹ç›®ï¼šYAPageView/">


<meta name="description" content="è½»é‡çº§ã€æ–°æ ·å¼è½®æ’­è§†å›¾ã€‚">
<meta name="keywords" content="iOSå¼€å‘,å¼€æºé¡¹ç›®">
<meta property="og:type" content="article">
<meta property="og:title" content="å¼€æºé¡¹ç›®ï¼šYAPageView">
<meta property="og:url" content="http://blog.chenyalun.com/2019/08/07/å¼€æºé¡¹ç›®ï¼šYAPageView/index.html">
<meta property="og:site_name" content="Ya">
<meta property="og:description" content="è½»é‡çº§ã€æ–°æ ·å¼è½®æ’­è§†å›¾ã€‚">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="https://image.chenyalun.com/2019/08/07/003.gif">
<meta property="og:image" content="https://image.chenyalun.com/2019/08/07/002.gif">
<meta property="og:image" content="https://image.chenyalun.com/2019/08/07/001.gif">
<meta property="og:updated_time" content="2019-10-27T05:55:20.871Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å¼€æºé¡¹ç›®ï¼šYAPageView">
<meta name="twitter:description" content="è½»é‡çº§ã€æ–°æ ·å¼è½®æ’­è§†å›¾ã€‚">
<meta name="twitter:image" content="https://image.chenyalun.com/2019/08/07/003.gif">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">





<script>
  var CONFIG = {
    search: false,
    searchPath: "/search.xml",
    fancybox: true,
    toc: true,
  }
</script>




  



    <title> å¼€æºé¡¹ç›®ï¼šYAPageView Â· Ya </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Ya</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags/é˜…è¯»/">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            About
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Ya</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              æ—¶é—´çº¿
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags/é˜…è¯»/">
            
            
              é˜…è¯»
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              å…³äº
            
          </a>
        </li>
      
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          å¼€æºé¡¹ç›®ï¼šYAPageView
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2019å¹´8æœˆ7æ—¥
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ä¸€ã€å‰è¨€"><span class="toc-text">ä¸€ã€å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#äºŒã€æ€è·¯"><span class="toc-text">äºŒã€æ€è·¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#é—´è·å¤„ç†"><span class="toc-text">é—´è·å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ— é™å¾ªç¯å¤„ç†"><span class="toc-text">æ— é™å¾ªç¯å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç‚¹å‡»äº‹ä»¶å¤„ç†"><span class="toc-text">ç‚¹å‡»äº‹ä»¶å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#è‡ªåŠ¨è½®æ’­å¤„ç†"><span class="toc-text">è‡ªåŠ¨è½®æ’­å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å®šæ—¶å™¨å¾ªç¯å¼•ç”¨å¤„ç†"><span class="toc-text">å®šæ—¶å™¨å¾ªç¯å¼•ç”¨å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç‚¹å‡»å›è°ƒå¾ªç¯å¼•ç”¨å¤„ç†"><span class="toc-text">ç‚¹å‡»å›è°ƒå¾ªç¯å¼•ç”¨å¤„ç†</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#ä¸‰ã€ä½¿ç”¨"><span class="toc-text">ä¸‰ã€ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æœ¬åœ°å›¾ç‰‡"><span class="toc-text">æœ¬åœ°å›¾ç‰‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç½‘ç»œå›¾ç‰‡"><span class="toc-text">ç½‘ç»œå›¾ç‰‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#è®¾ç½®è‡ªåŠ¨è½®æ’­æ—¶é—´"><span class="toc-text">è®¾ç½®è‡ªåŠ¨è½®æ’­æ—¶é—´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#è®¾ç½®ç‚¹å‡»å›è°ƒ"><span class="toc-text">è®¾ç½®ç‚¹å‡»å›è°ƒ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å››ã€æ€»ç»“"><span class="toc-text">å››ã€æ€»ç»“</span></a></li>
    </div>
  </div>


    <div class="post-content">
      
        <p></p><p align="center"> è½»é‡çº§ã€æ–°æ ·å¼è½®æ’­è§†å›¾ã€‚ </p><br><a id="more"></a><p></p>
<h1 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h1><p>åœ¨æ‹œè¯»<a href="http://adad184.com/" target="_blank" rel="noopener">é‡Œè„Šä¸²çš„å¼€å‘éšç¬”</a>å¤§ç¥çš„åšå®¢æ—¶ï¼Œå‘ç°ä¸ªå¥½ç©çš„ä¸œè¥¿ï¼š<a href="http://adad184.com/2015/07/01/opensource-xxpagingscrollview/" target="_blank" rel="noopener">ã€Šå¼€æºé¡¹ç›®:XXPagingScrollViewã€‹</a>ã€‚è™½ç„¶æ˜¯å¾ˆå¸¸è§çš„è½®æ’­è§†å›¾ï¼Œä½†æ˜¯è¿™ç§æ–°æ ·å¼çš„å®ç°æ€è·¯æŒºæœ‰æ„æ€ã€‚è®°å¾—ä¸¤å¹´å‰åœ¨å†™æŸä¸ªé¡¹ç›®æ—¶ä¹Ÿé‡åˆ°è¿‡è¿™ä¸ªï¼Œä½†æ˜¯å½“ç„¶ç¡®å®æ²¡æœ‰æƒ³å‡ºæ¥å’‹å®ç°è¿™ç§éå…¨å±æœ‰é—´éš™çš„è½®æ’­æ§ä»¶ã€‚</p>
<p>è¯»å®Œå¤§ç¥çš„æ–‡ç« ï¼Œå¾ˆæ˜¯å…´å¥‹ï¼Œä¸€èˆ¬æ˜¯ä¸çˆ±é€ é‡å¤çš„è½®å­ï¼Œä½†æ˜¯ä½œè€…è¿™ä¸ªæ˜¯<a href="https://github.com/adad184/XXPagingScrollView/blob/master/Classes/XXPagingScrollView.swift" target="_blank" rel="noopener">Swiftç‰ˆæœ¬</a>çš„ï¼Œè€Œä¸”æ˜¯åŸºç¡€ç»„ä»¶ï¼Œå°‘äº†å¾ˆå¤šåŠŸèƒ½ï¼Œæ‰€ä»¥å¿ƒè¡€æ¥æ½®ï¼Œåœ¨å¤§ç¥åŸºç¡€ä¸Šå†è¿›ä¸€æ­¥ã€‚</p>
<p>ç›¸æ¯”è¾ƒæ¥è¯´æ›´åŠ å®Œå–„äº†ï¼š</p>
<ul>
<li>æ”¯æŒè®¾ç½®pagingWidth</li>
<li>æ”¯æŒè®¾ç½®pageInset</li>
<li>æ”¯æŒæ— é™å¾ªç¯è½®æ’­</li>
<li>æ”¯æŒæœ¬åœ°å›¾ç‰‡</li>
<li>æ”¯æŒç½‘ç»œå›¾ç‰‡</li>
<li>æ”¯æŒè‡ªåŠ¨è½®æ’­ã€è®¾ç½®è½®æ’­æ—¶é—´é—´éš”</li>
<li>æ”¯æŒç‚¹å‡»å›è°ƒ</li>
</ul>
<p>æ•´ä½“ä»£ç çº¦150è¡Œå·¦å³ï¼Œæ›´åŠ ç²¾ç®€ã€‚<br><img src="https://image.chenyalun.com/2019/08/07/003.gif"><br>é¡¹ç›®åœ°å€:<a href="https://github.com/ChenYalun/YAPageView" target="_blank" rel="noopener">https://github.com/ChenYalun/YAPageView</a></p>
<h1 id="äºŒã€æ€è·¯"><a href="#äºŒã€æ€è·¯" class="headerlink" title="äºŒã€æ€è·¯"></a>äºŒã€æ€è·¯</h1><p>å®é™…ä¸Šè½®æ’­è§†å›¾æ˜¯çƒ‚å¤§è¡—çš„ä¸œè¥¿äº†ï¼Œç½‘ä¸Šç°æˆä»£ç ç‰¹åˆ«å¤šã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå‡å®šéœ€è¦nä¸ªé¡µé¢ï¼Œå®ç°æ–¹å¼æœ‰ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>UIScrollView</code>ï¼Œæ·»åŠ  n ä¸ª<code>UIImageView</code>ã€‚</li>
<li>ä½¿ç”¨<code>UIScrollView</code>ï¼Œæ·»åŠ ä¸¤ä¸ª<code>UIImageView</code>ï¼ŒåŠ¨æ€å¾ªç¯è°ƒæ•´ã€‚</li>
<li>ä½¿ç”¨<code>UICollectionView</code>ã€‚</li>
</ol>
<p>æ–¹æ³•1æ¯”è¾ƒåŸºç¡€ï¼Œæ›´é€‚åˆéå¾ªç¯ï¼›æ–¹æ³•3æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯<code>UICollectionView</code>è¿‡äºheavilyã€‚<br>æ–¹æ³•2ï¼Œå¾ˆç²¾ç®€è½»é‡ï¼Œå°±æ˜¯å¤„ç†èµ·æ¥æœ‰ç‚¹ç»•ã€‚ç„¶è€Œï¼Œç»•ä¸€æ¬¡ï¼Œæ¢æ¥æ°¸ä¹…çš„èˆ’é€‚ï¼Œå¾ˆå€¼å¾—ã€‚</p>
<p>å¦‚ä½•å®ç°è‡ªå®šä¹‰<code>Page width</code>çš„è§†å›¾ï¼Œä½œè€…ç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ï¼š</p>
<blockquote>
<p>æ–¹æ¡ˆ1: ä¸ä½¿ç”¨<code>pagingEnabled</code>å±æ€§ è€Œæ˜¯æ‰‹åŠ¨çš„è®¡ç®—å¹¶è®¾ç½®æ»‘åŠ¨åç§»<br>æ–¹æ¡ˆ2: ä½¿ç”¨<code>pagingEnabled</code>å±æ€§ æ‰©å¤§<code>UIScrollview</code>çš„æ˜¾ç¤ºèŒƒå›´å³å¯</p>
</blockquote>
<p>å¾ˆæ˜æ˜¾ï¼Œæ–¹æ¡ˆ2æ›´å¥½ã€‚æ€è·¯æ˜¯ï¼Œæ‰©å¤§<code>UIScrollView</code>çš„å¯æ˜¾ç¤ºèŒƒå›´å¹¶è®©UIScrollViewå“åº”è¶…å‡ºå…¶æœ¬èº«èŒƒå›´çš„è§¦æ‘¸äº‹ä»¶ã€‚æ€è·¯çŸ¥é“äº†ï¼Œå®ç°èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯<code>clipsToBounds</code>å±æ€§å’Œ<code>pointInside</code>æ–¹æ³•ã€‚</p>
<h4 id="é—´è·å¤„ç†"><a href="#é—´è·å¤„ç†" class="headerlink" title="é—´è·å¤„ç†"></a>é—´è·å¤„ç†</h4><p>æ ¸å¿ƒæœ‰ä¸‰æ¡ï¼š</p>
<ol>
<li><code>UIScrollView</code>çš„å®½åº¦å°±æ˜¯<code>pageWidth + pageInset</code>ã€‚</li>
<li>ä¸ºäº†ä¿æŒå·¦å³æ˜¾ç¤ºåŒºåŸŸçš„å¯¹ç§°æ€§ï¼Œ<code>UIScrollView</code>çš„<code>x</code>æ˜¯<code>(superView.width - pageWidth) * 0.5</code>ã€‚</li>
<li>å­è§†å›¾çš„frameæ˜¯<code>CGRectMake(idx * (pageWidth + pageInset), 0, pageWidth, height)</code>ï¼Œä¹Ÿå³ï¼Œå­è§†å›¾çš„å®½åº¦ä¸<code>UIScrollView</code>çš„å®½åº¦ä¿æŒä¸€è‡´ã€‚</li>
</ol>
<h4 id="æ— é™å¾ªç¯å¤„ç†"><a href="#æ— é™å¾ªç¯å¤„ç†" class="headerlink" title="æ— é™å¾ªç¯å¤„ç†"></a>æ— é™å¾ªç¯å¤„ç†</h4><ol>
<li>è§†å›¾å¾ªç¯åˆ©ç”¨<br>ä½¿ç”¨ä¸‰ä¸ª<code>UIImageView</code>ï¼Œè®°ä¸ºå·¦ã€ä¸­ã€å³ï¼Œé‡å¤åˆ©ç”¨ã€‚é»˜è®¤æ˜¾ç¤ºä¸­é—´çš„imageViewã€‚</li>
<li>åˆ·æ–°é€»è¾‘<br>åœ¨<code>scrollViewDidScroll</code>å›è°ƒä¸­ï¼Œå½“<code>UIScrollView</code>å³å°†æ˜¾ç¤ºå‡ºä¸‹ä¸€ä¸ªï¼ˆå¯èƒ½æ˜¯å·¦ã€ä¹Ÿå¯èƒ½æ˜¯å³ï¼‰è§†å›¾æ—¶ï¼Œç«‹å³è°ƒç”¨åˆ·æ–°æ–¹æ³•ã€‚åˆ·æ–°çš„é€»è¾‘æ˜¯ï¼š</li>
</ol>
<ul>
<li><p>é‡æ–°è®¡ç®—leftã€currentIndexã€rightä¸‰ä¸ªç´¢å¼•</p>
  <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kLeft (_currentIndex == 0 ? kCount - 1 : _currentIndex - 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> kRight (_currentIndex == kCount - 1 ? 0 : _currentIndex + 1)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹å·¦ã€ä¸­ã€å³ä¸‰ä¸ª<code>UIImageView</code>é‡æ–°è®¾ç½®é…å›¾</p>
  <figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">self.pageArray<span class="string">[0]</span>.image = self.imageArray<span class="string">[kLeft]</span>;</span><br><span class="line">self.pageArray<span class="string">[1]</span>.image = self.imageArray<span class="string">[_currentIndex]</span>;</span><br><span class="line">self.pageArray<span class="string">[2]</span>.image = self.imageArray<span class="string">[kRight]</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»¥éåŠ¨ç”»æ–¹å¼è®¾ç½®<code>UIScrollView</code>çš„åç§»é‡</p>
  <figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> x = <span class="keyword">self</span>.scrollView.contentOffset.x;</span><br><span class="line"><span class="built_in">CGFloat</span> width = <span class="keyword">self</span>.pageWidth + <span class="keyword">self</span>.pageInset;</span><br><span class="line"><span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">   x = width;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   x += x &gt; width ? -width : width;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(x, <span class="number">0</span>)];</span><br></pre></td></tr></table></figure>
<p>  è¿™æ ·ä¾¿å®ç°äº†æ— é™å¾ªç¯ã€‚</p>
</li>
</ul>
<ol start="3">
<li><p>åˆ·æ–°æ—¶æœºå¤„ç†<br><code>scrollViewDidScroll</code>ä¼šå›è°ƒå¾ˆå¤šæ¬¡ï¼Œæœ¬æ¥ä»¥ä¸ºä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½å°±å¯ä»¥æ§åˆ¶åªåˆ·æ–°ä¸€æ¬¡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®ç°ğŸ˜‚ æ‰€ä»¥ï¼Œé€€ä¸€æ­¥ï¼Œç”¨äº†ä¸¤ä¸ªæ ‡å¿—ä½ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> leftLock;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> rightLock;</span><br></pre></td></tr></table></figure>
<p>é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Turn left.</span></span><br><span class="line"><span class="keyword">if</span> (offsetX &gt; <span class="number">2</span> * (width - <span class="keyword">self</span>.pageInset)) <span class="keyword">self</span>.rightLock = <span class="literal">NO</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">self</span>.leftLock &amp;&amp; offsetX &lt; width - <span class="number">2</span> * <span class="keyword">self</span>.pageInset) &#123;</span><br><span class="line">    <span class="keyword">self</span>.leftLock = <span class="literal">YES</span>;</span><br><span class="line">    _currentIndex = kLeft;</span><br><span class="line">    [<span class="keyword">self</span> refresh];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Turn right.</span></span><br><span class="line"><span class="keyword">if</span> (offsetX &lt; <span class="number">2</span> * <span class="keyword">self</span>.pageInset) <span class="keyword">self</span>.leftLock = <span class="literal">NO</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">self</span>.rightLock &amp;&amp; offsetX &gt; width + <span class="number">2</span> * <span class="keyword">self</span>.pageInset) &#123;</span><br><span class="line">    <span class="keyword">self</span>.rightLock = <span class="literal">YES</span>;</span><br><span class="line">    _currentIndex = kRight;</span><br><span class="line">    [<span class="keyword">self</span> refresh];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> è¯·ç‰¢è®°<code>UIScrollView</code>çš„å®½åº¦widthæ˜¯<code>width=pageWidth+pageInset</code>ï¼Œè¿™é‡Œä»¥å³å°†æ˜¾ç¤ºå³è¾¹è§†å›¾ä¸ºä¾‹ï¼š<br> scrollViewçš„åˆå§‹åç§»é‡æ˜¯<code>width</code>ï¼Œé€æ¸åç§»ï¼Œç›´åˆ°è¶Šè¿‡ç©ºç™½é—´è·(pageInset)è¦æ˜¾ç¤ºä¸‹ä¸€ä¸ªè§†å›¾æ—¶ï¼Œæ­¤æ—¶offsetXä¸º<code>width + (pageWidth - pageInset)</code>ï¼Œä¹Ÿå³ä»£ç ä¸­çš„<code>2 * (width - pageInset)</code>ï¼Œç«‹å³å°†offsetXè¿˜åŸä¸º<code>2 * (width - pageInset) - (width)</code>ä¹Ÿå°±æ˜¯<code>pageWidth-pageInset</code>ï¼Œå¯¹leftLockåŠ é”ï¼Œæ›´æ–°å½“å‰ç´¢å¼•ã€‚</p>
</li>
</ol>
<h4 id="ç‚¹å‡»äº‹ä»¶å¤„ç†"><a href="#ç‚¹å‡»äº‹ä»¶å¤„ç†" class="headerlink" title="ç‚¹å‡»äº‹ä»¶å¤„ç†"></a>ç‚¹å‡»äº‹ä»¶å¤„ç†</h4><p>å¯¹<code>UIScrollView</code>æ·»åŠ ç‚¹å‡»æ‰‹åŠ¿ï¼Œè®¡ç®—å‡ºå½“å‰ç‚¹å‡»ä½ç½®åœ¨å›¾ç‰‡æ•°ç»„ä¸­çš„ç´¢å¼•å³å¯ï¼š<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> pointX = [tap locationInView:tap.view].x;</span><br><span class="line"><span class="built_in">NSUInteger</span> idx = _currentIndex;</span><br><span class="line"><span class="keyword">if</span> (pointX &lt; <span class="keyword">self</span>.pageWidth + <span class="keyword">self</span>.pageInset) &#123;</span><br><span class="line">   idx = kLeft;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (pointX &gt; <span class="number">2</span> * <span class="keyword">self</span>.pageWidth + <span class="keyword">self</span>.pageInset) &#123;</span><br><span class="line">   idx = kRight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="è‡ªåŠ¨è½®æ’­å¤„ç†"><a href="#è‡ªåŠ¨è½®æ’­å¤„ç†" class="headerlink" title="è‡ªåŠ¨è½®æ’­å¤„ç†"></a>è‡ªåŠ¨è½®æ’­å¤„ç†</h4><p>å½“è®¾ç½®<code>timeInterval</code>å±æ€§æ—¶ï¼Œè¯´æ˜éœ€è¦è‡ªåŠ¨è½®æ’­ï¼Œæ‡’åŠ è½½åˆ›å»ºå®šæ—¶å™¨ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">_timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:_timeInterval repeats:<span class="literal">YES</span> block:^(<span class="built_in">NSTimer</span> *timer) &#123;</span><br><span class="line">    [<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(<span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.scrollView.frame) * <span class="number">2</span>, <span class="number">0</span>) animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>å¹¶æŠŠå®šæ—¶å™¨æ”¾åˆ°<code>currentRunLoop</code>ä¸­ï¼Œè®¾ç½®<code>NSRunLoopCommonModes</code>ã€‚å½“ç„¶ï¼Œéœ€è¦åœ¨ScrollViewçš„ä¸€äº›ä»£ç†ä¸­å¤„ç†ç”¨æˆ·æ‰‹åŠ¨æ»‘åŠ¨ä¸å®šæ—¶å™¨è®¾ç½®çš„æ»‘åŠ¨çš„å†²çªã€‚</p>
<h4 id="å®šæ—¶å™¨å¾ªç¯å¼•ç”¨å¤„ç†"><a href="#å®šæ—¶å™¨å¾ªç¯å¼•ç”¨å¤„ç†" class="headerlink" title="å®šæ—¶å™¨å¾ªç¯å¼•ç”¨å¤„ç†"></a>å®šæ—¶å™¨å¾ªç¯å¼•ç”¨å¤„ç†</h4><p>è§£å†³æ–¹å¼æ˜¯ï¼Œå½“PageViewä»çˆ¶è§†å›¾ä¸Šç§»é™¤æ—¶ï¼Œæ‰‹åŠ¨é”€æ¯å®šæ—¶å™¨ï¼š<br><figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">- (void)willMoveToSuperview:<span class="type"></span>(UIView *)<span class="keyword">new</span><span class="type">Superview</span> &#123;</span><br><span class="line">    [<span class="keyword">super</span> willMoveToSuperview:<span class="type">newSuperview</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span><span class="type">Superview</span> == nil) &#123; <span class="comment">// è§†å›¾ä»çˆ¶è§†å›¾ç§»é™¤æ—¶, é”€æ¯å®šæ—¶å™¨</span></span><br><span class="line">        [_timer invalidate];</span><br><span class="line">        _timer = nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ç‚¹å‡»å›è°ƒå¾ªç¯å¼•ç”¨å¤„ç†"><a href="#ç‚¹å‡»å›è°ƒå¾ªç¯å¼•ç”¨å¤„ç†" class="headerlink" title="ç‚¹å‡»å›è°ƒå¾ªç¯å¼•ç”¨å¤„ç†"></a>ç‚¹å‡»å›è°ƒå¾ªç¯å¼•ç”¨å¤„ç†</h4><p>ç‚¹å‡»äº‹ä»¶ç»™å‡ºçš„æ¥å£æˆ‘é€‰æ‹©ä½¿ç”¨blockï¼Œï¼ˆä½¿ç”¨å¼±å¼•ç”¨çš„ä»£ç†å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº†ï¼Œä½†æ˜¯ä»£ç†ä¼šå¢åŠ è°ƒç”¨çš„å¤æ‚æ€§ï¼Œè®¾ç½®ä»£ç†ã€éµå®ˆåè®®ã€å®ç°æ–¹æ³•å·´æ‹‰å·´æ‹‰ã€‚ã€‚ã€‚ï¼‰</p>
<p>ç„¶è€Œï¼ŒåŒè®¸å¤šè§†å›¾çš„blockå›è°ƒä¸€æ ·ï¼Œä¼šæœ‰å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œåªèƒ½è¿™æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">pageView.tapHandler = ^(<span class="built_in">NSUInteger</span> idx, <span class="built_in">UIImage</span> *img, <span class="built_in">NSURL</span> *url) &#123;</span><br><span class="line">   __<span class="keyword">strong</span> <span class="keyword">typeof</span>(weakSelf) <span class="keyword">self</span> = weakSelf;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"self = %@, index = %lu, url = %@"</span>, <span class="keyword">self</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)idx, url);</span><br><span class="line">   <span class="comment">/// ....</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸‡ä¸€è°ƒç”¨æ–¹å¿˜äº†å‘¢ï¼Œé‚£å°±å†…å­˜æ³„æ¼äº†ã€‚</p>
<p>å¤§ç¥<a href="https://yulingtianxia.com/blog/2015/11/13/Summary-of-the-first-month-in-the-internship-of-Tencent/" target="_blank" rel="noopener">ç‰ä»¤å¤©ä¸‹</a>çš„æ–¹å¼æ˜¯ä½¿ç”¨å¼±å¼•ç”¨çš„å˜é‡æŒæœ‰å¤–ç•Œçš„è°ƒç”¨è€…ï¼Œç„¶ååœ¨é€‚å½“æ—¶æœºå°†ç»„ä»¶â€œè‡ªå·±â€ç½®ä¸ºç©ºã€‚ä¸è¿‡éœ€è¦ç»™è°ƒç”¨è€…å†™ä¸ªåˆ†ç±»ï¼ˆå±æ€§ï¼‰æŒæœ‰ç»„ä»¶ï¼Œè¿˜éœ€è¦æ˜ç¡®åˆ‡æ–­å¾ªç¯å¼•ç”¨çš„æ—¶æœºï¼Œå¯¹äºæˆ‘çš„è¿™ä¸ª100æ¥è¡Œçš„PageViewï¼Œå¯èƒ½æœ‰ç‚¹ä¸å¤ªåˆé€‚ã€‚</p>
<p>çªç„¶è„‘æ´ä¸€å¼€ï¼Œæƒ³åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¾å¼è®©ä½¿ç”¨æ–¹ä¼ è¿›æ¥è°ƒç”¨è€…ï¼Œé‡æ–°å®šä¹‰å¤–ç•Œçš„<code>self</code>ï¼Œå°†å…¶ä½œä¸ºä¸€ä¸ªå›è°ƒå‚æ•°ä¼ é€’ç»™ä½¿ç”¨æ–¹ï¼ˆPageViewå†…éƒ¨ä½¿ç”¨weakæŒæœ‰å¤–ç•Œçš„<code>self</code>ï¼‰ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="keyword">void</span> (^tapHandler)(<span class="built_in">NSUInteger</span> idx, <span class="built_in">UIImage</span> *img, <span class="built_in">NSURL</span> *url, <span class="keyword">id</span> <span class="keyword">self</span>);</span><br></pre></td></tr></table></figure>
<p>å¤–ç•Œä½¿ç”¨çš„æ—¶å€™åƒè¿™æ ·ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">pageView.tapHandler = ^(<span class="built_in">NSUInteger</span> idx, <span class="built_in">UIImage</span> *img, <span class="built_in">NSURL</span> *url, <span class="built_in">UIViewController</span> *<span class="keyword">self</span>) &#123;</span><br><span class="line">   [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç¡®å®èƒ½è§£å†³å¾ªç¯å¼•ç”¨ï¼Œè€Œä¸”ä¸æ˜¯å¾ˆè´¹äº‹ã€‚ä½†æ˜¯ï¼Œå®é™…ä½¿ç”¨çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">pageView.tapHandler = ^(<span class="built_in">NSUInteger</span> idx, <span class="built_in">UIImage</span> *img, <span class="built_in">NSURL</span> *url, <span class="keyword">id</span> controller) &#123;</span><br><span class="line">   <span class="comment">// éœ€è¦æ‰‹åŠ¨æŠŠidç±»å‹æ”¹æˆå®é™…çš„ç±»å‹ï¼Œå¦‚UIViewControllerã€UIViewç­‰ç­‰</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸çŸ¥é“å¤–ç•Œçš„<code>self</code>æ˜¯å•¥ç±»å‹ï¼Œåªèƒ½ç”¨<code>id</code>ã€‚æˆ‘æ„Ÿè§‰ä¹Ÿä¸æ˜¯å¾ˆå·§å¦™ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯ä½¿ç”¨è‹¹æœæ¨èçš„ä¸»æµçš„weak-strongå§ã€‚</p>
<h1 id="ä¸‰ã€ä½¿ç”¨"><a href="#ä¸‰ã€ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ä½¿ç”¨"></a>ä¸‰ã€ä½¿ç”¨</h1><h4 id="æœ¬åœ°å›¾ç‰‡"><a href="#æœ¬åœ°å›¾ç‰‡" class="headerlink" title="æœ¬åœ°å›¾ç‰‡"></a>æœ¬åœ°å›¾ç‰‡</h4><p>æœ¬åœ°å›¾ç‰‡ç›´æ¥ä¼ å…¥UIImageæ•°ç»„å³å¯ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šæ„é€ å™¨ï¼Œè®¾å®špageWidthã€pageInsetç­‰</span></span><br><span class="line">YAPageView *pageView = [[YAPageView alloc] <span class="string">initWithFrame:</span>CGRectMake(<span class="number">0</span>, <span class="number">200</span>, kScreenWidth, <span class="number">200</span>) <span class="string">controller:</span>self <span class="string">pageWidth:</span><span class="number">300</span> <span class="string">pageInset:</span><span class="number">20</span>];</span><br><span class="line">pageView.imageArray = @[</span><br><span class="line">    [UIImage <span class="string">imageNamed:</span>@<span class="string">"1"</span>],</span><br><span class="line">    [UIImage <span class="string">imageNamed:</span>@<span class="string">"2"</span>],</span><br><span class="line">    [UIImage <span class="string">imageNamed:</span>@<span class="string">"3"</span>],</span><br><span class="line">    [UIImage <span class="string">imageNamed:</span>@<span class="string">"4"</span>],</span><br><span class="line">    [UIImage <span class="string">imageNamed:</span>@<span class="string">"5"</span>],</span><br><span class="line">    [UIImage <span class="string">imageNamed:</span>@<span class="string">"6"</span>],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h4 id="ç½‘ç»œå›¾ç‰‡"><a href="#ç½‘ç»œå›¾ç‰‡" class="headerlink" title="ç½‘ç»œå›¾ç‰‡"></a>ç½‘ç»œå›¾ç‰‡</h4><p>ç½‘ç»œå›¾ç‰‡ä¼ å…¥å›¾ç‰‡URLæ•°ç»„ï¼Œå¹¶è®¾ç½®å¤„ç†å›¾ç‰‡çš„blockã€‚è¿™ä¸ªblockæŒ‡çš„æ˜¯ç»™UIImageViewè®¾ç½®å›¾ç‰‡URLçš„æ–¹å¼ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä½¿ç”¨SDWebImageï¼Œå¯ä»¥è¿™ä¹ˆè®¾ç½®</span></span><br><span class="line">pageView.configImageHandler = ^(<span class="built_in">UIImageView</span> *imageView, <span class="built_in">NSURL</span> *url) &#123;</span><br><span class="line">   [imageView sd_setImageWithURL:url];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">pageView.imageURLArray = @[</span><br><span class="line">    [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://picsum.photos/id/230/350/200"</span>],</span><br><span class="line">    [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://picsum.photos/id/231/350/200"</span>],</span><br><span class="line">    [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://picsum.photos/id/232/350/200"</span>],</span><br><span class="line">    [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://picsum.photos/id/233/350/200"</span>],</span><br><span class="line">    [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://picsum.photos/id/234/350/200"</span>],</span><br><span class="line">    [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://picsum.photos/id/235/350/200"</span>]</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h4 id="è®¾ç½®è‡ªåŠ¨è½®æ’­æ—¶é—´"><a href="#è®¾ç½®è‡ªåŠ¨è½®æ’­æ—¶é—´" class="headerlink" title="è®¾ç½®è‡ªåŠ¨è½®æ’­æ—¶é—´"></a>è®¾ç½®è‡ªåŠ¨è½®æ’­æ—¶é—´</h4><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">pageView.timeInterval = <span class="number">3</span>.f<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="è®¾ç½®ç‚¹å‡»å›è°ƒ"><a href="#è®¾ç½®ç‚¹å‡»å›è°ƒ" class="headerlink" title="è®¾ç½®ç‚¹å‡»å›è°ƒ"></a>è®¾ç½®ç‚¹å‡»å›è°ƒ</h4><p>åˆ«å¿˜äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">pageView.tapHandler = ^(<span class="built_in">NSUInteger</span> idx, <span class="built_in">UIImage</span> *img, <span class="built_in">NSURL</span> *url) &#123;</span><br><span class="line">   __<span class="keyword">strong</span> <span class="keyword">typeof</span>(weakSelf) <span class="keyword">self</span> = weakSelf;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"self = %@, index = %lu, url = %@"</span>, <span class="keyword">self</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)idx, url);</span><br><span class="line">   [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><p>æ•´ä½“è€Œè¨€ï¼Œæ²¡æœ‰å†—ä½™é€»è¾‘ï¼Œèƒ½ä¼˜åŒ–çš„ä¹Ÿä¼˜åŒ–äº†ï¼ˆæ¯”å¦‚ç´¢å¼•è®¡ç®—å¯¹å–æ¨¡çš„ä¼˜åŒ–ã€å®šæ—¶å™¨æ‡’åŠ è½½ã€åˆ·æ–°æ—¶æœºæ¬¡æ•°ç­‰ç­‰ï¼‰ï¼Œåº”è¯¥ç®—æ˜¯æ¯”è¾ƒè½»é‡äº†å§å“ˆå“ˆå“ˆå“ˆã€‚</p>
<p>å…·ä½“åº”ç”¨æ–¹é¢ï¼Œæ¯”å¦‚è…¾è®¯è§†é¢‘Appä¸­çš„é¦–é¡µTabã€ä¼šå‘˜Tabéƒ½æœ‰è¿™ç§custom widthçš„è½®æ’­å›¾ã€‚<br><img src="https://image.chenyalun.com/2019/08/07/002.gif" style="zoom:80%"></p>
<p>QQéŸ³ä¹ä¸­çš„å‘ç°Tabä¹Ÿæ˜¯è¿™ç§è½®æ’­å›¾ï¼Œä¸è¿‡ä¸èƒ½æ— é™å¾ªç¯ï¼ˆä¸èƒ½æ— é™å¾ªç¯å²‚ä¸æ˜¯æ›´ç®€å•ã€‚ã€‚ï¼‰ã€‚<br><img src="https://image.chenyalun.com/2019/08/07/001.gif" style="zoom:80%"></p>
<p>å¥½äº†ï¼ŒæŠŠä¸¤å¹´å‰çš„å‘å¡«ä¸Šäº†ã€‚</p>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/iOSå¼€å‘/">iOSå¼€å‘</a>
            
              <a href="/tags/å¼€æºé¡¹ç›®/">å¼€æºé¡¹ç›®</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2019/08/22/Objective-Cè®¾è®¡æŒ‡åŒ—/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Objective-Cè®¾è®¡æŒ‡åŒ—</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    
    
      <a class="next" href="/2019/07/31/æ•°æ®ç»“æ„çš„Swiftå®ç°/">
        <span class="next-text nav-default">æ•°æ®ç»“æ„çš„Swiftå®ç°</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/ChenYalun" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a href="https://weibo.com/icqk" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
    
      
    
      
        
          <a href="https://stackoverflow.com/users/7026915/allen" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
        
      
    
    
    
  </div>


<div class="copyright">
  <span class="power-by">
    May Be 
  </span>
  
  <span class="theme-info">
    Better  
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even"> </a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2014 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Ya</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  
  <script>
    var cloudTieConfig = {
      url: document.location.href, 
      sourceId: "",
      productKey: "f132359147224247aa1c3ad32d20490b",
      target: "cloud-tie-wrapper"
    };
  </script>
  <script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>





    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  </body>
</html>
